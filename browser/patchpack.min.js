/*! patchpack@0.3.3 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.patchpack=t():e.patchpack=t()}(self||this,function(){return i={},n.m=r=[function(e,t,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.OP_REMOVE=t.OP_REPLACE=t.OP_ADD=t.check=t.MAP_NODE=t.ARRAY_NODE=void 0,t.ARRAY_NODE=-1,t.MAP_NODE=-2,t.check=function(e,t){if(e)throw new Error(t)},t.OP_ADD=(i=[0,1,2])[0],t.OP_REPLACE=i[1],t.OP_REMOVE=i[2]},function(e,t,r){"use strict";var i=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var i=Array(e),n=0,t=0;t<r;t++)for(var s=arguments[t],o=0,f=s.length;o<f;o++,n++)i[n]=s[o];return i};Object.defineProperty(t,"__esModule",{value:!0}),t.Schema=void 0;var s=r(0),r=(Object.defineProperty(n.prototype,"types",{get:function(){return this._types.map(function(e){var t=e.name,e=e.props;return i([t],e)})},enumerable:!1,configurable:!0}),n.prototype.typeByName=function(t){return this._types.find(function(e){return e.name===t})},Object.defineProperty(n.prototype,"root",{get:function(){return this._nodes[0]},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"nextId",{get:function(){return this._nextId++},enumerable:!1,configurable:!0}),n.prototype.init=function(e){var r=this;this._types=[],this._nodes=[],e.forEach(function(e){var t=e[0],e=e.slice(1);return r._types.push({name:t,props:e,index:r._types.length})})},n.prototype.getNode=function(t){return this._nodes.find(function(e){return e.id===t})},n.prototype.getNodePath=function(e,t){for(var r=e,i=[];r;)i.push(r.key),r=r.parent;return i.reverse().join("/")+(t?"/"+t:"")},n.prototype.getChildNode=function(e,t){return e.type===s.MAP_NODE?e.items.find(function(e){return e.key===t}):e.type===s.ARRAY_NODE?e.items.find(function(e){return e.index===+t}):e.items[e.type.props.indexOf(t)]},n.prototype.findType=function(n){var s=Object.keys(n);return this._types.find(function(e){if(e.ref)return n instanceof e.ref;for(var t=0,r=s;t<r.length;t++){var i=r[t];if(e.props.indexOf(i)<0)return!1}return!0})},n.prototype.getType=function(e){return e<0?e:this._types[e]},n.prototype.getChildIndex=function(e,t){return e.type===s.MAP_NODE?e.keys.indexOf(t):e.type===s.ARRAY_NODE?+t:e.type.props.indexOf(t)},n.prototype.getChildName=function(e,t){return e?e.type===s.MAP_NODE?e.keys[t]:e.type===s.ARRAY_NODE?t:e.type.props[t]:""},n.prototype.createNode=function(e,t,r,i,n){n={id:e,type:r,parent:t,key:i,index:n,items:[]};return r===s.MAP_NODE&&(n.keys=[]),null!=t&&t.items.push(n),this._nodes.push(n),n},n.prototype.deleteNode=function(e){var t=this;e.items.forEach(function(e){return t.deleteNode(e)});e=this._nodes.indexOf(e);this._nodes.splice(e,1)},n);function n(i){this._nextId=0,this._nodes=[],this._types=Object.keys(i).map(function(e,t){var r=i[e];return Array.isArray(r)?{name:e,props:r,index:t}:{name:r.name,props:Object.getOwnPropertyNames(new r),index:t,ref:r}})}t.Schema=r},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(3),t),n(r(1),t),n(r(0),t)},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t},o=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var i=Array(e),n=0,t=0;t<r;t++)for(var s=arguments[t],o=0,f=s.length;o<f;o++,n++)i[n]=s[o];return i};Object.defineProperty(t,"__esModule",{value:!0}),t.PatchPack=void 0;var h=s(r(4)),l=r(0),f=r(1),r=(a.prototype.encodeState=function(e,t,r){void 0===t&&(t=!0),void 0===r&&(r=!0);r=this.encodeNode(e,{key:"",index:-1,updateSchema:r}),t=o([r],t?[this.schema.types]:[]);return h.encode(t)},a.prototype.decodeState=function(e){var t=h.decode(e),e=t[0],t=t[1];return this.schema.init(t),this.decodeNode(e,{key:"",index:-1})},a.prototype.encodeNode=function(r,e){var i=this,t=e.parent,n=e.key,s=void 0===n?"":n,n=e.index,n=void 0===n?-1:n,e=e.updateSchema,o=void 0===e||e;t&&t.type===l.MAP_NODE&&t.keys.push(s);var f=t?this.schema.getChildNode(t,s):this.schema.root,h=[];if(Array.isArray(r)){f=f||this.schema.createNode(this.schema.nextId,t,l.ARRAY_NODE,s,n),h.push(l.ARRAY_NODE,f.id);for(var a=0;a<r.length;a++)h.push(this.encodeNode(r[a],{parent:f,key:a,index:a,updateSchema:o}))}else{if("object"!=typeof r||!r)return l.check("function"==typeof r||"symbol"==typeof r,"Cannot encode value - wrong value on path "+this.schema.getNodePath(t,s)),r;var u=this.schema.findType(r)||l.MAP_NODE,f=f||o&&this.schema.createNode(this.schema.nextId,t,u,s,n);l.check(!f,"Cannot encode value - node not found on path: "+this.schema.getNodePath(t,s)),h.push(u!==l.MAP_NODE?u.index:l.MAP_NODE,f.id),u!==l.MAP_NODE?Object.keys(r).forEach(function(e){h.push(i.encodeNode(r[e],{parent:f,key:e,index:u.props.indexOf(e),updateSchema:o}))}):Object.keys(r).forEach(function(e,t){h.push(e,i.encodeNode(r[e],{parent:f,key:e,index:t,updateSchema:o}))})}return h},a.prototype.decodeNode=function(e,t){var r=this;if(!e||!Array.isArray(e))return e;var i=t.parent,n=t.key,s=t.index,o=e[0],t=e[1],f=e.slice(2),h=this.schema.getType(o);l.check(!h,"Cannot decode state - unknown type: "+o);var a=this.schema.createNode(t,i,h,n,s),u={};if(h===l.ARRAY_NODE)return f.map(function(e,t){return r.decodeNode(e,{parent:a,index:t,key:t})});if(h===l.MAP_NODE)for(var c=0;c<f.length;c+=2){var p=a.keys.push(f[c])-1;void 0!==(d=this.decodeNode(f[c+1],{parent:a,key:f[c],index:p}))&&(u[f[c]]=d)}else for(c=0;c<h.props.length;c++){var d,_=h.props[c];void 0!==(d=this.decodeNode(f[c],{parent:a,key:_,index:c}))&&(u[_]=d)}return u},a.prototype.encodePatch=function(e,t){void 0===t&&(t=!0);var r=("/"===e.path[0]?e.path.slice(1):e.path).split("/").reverse(),i=r.splice(0,1)[0],n=this.schema.root;for(l.check(!n,"Cannot encode patch, you need to build schema first!");r.length;)n=this.schema.getChildNode(n,r.pop()),l.check(!n,"Cannot add new node - wrong path: "+e.path);var s=["add","replace","remove"].indexOf(e.op),o=this.schema.getChildIndex(n,i),f=[s,n.id,o],s=this.schema.getChildNode(n,i);return"remove"!==e.op&&(s&&t&&this.schema.deleteNode(s),n.type===l.MAP_NODE&&"add"===e.op?f.push([i,this.encodeNode(e.value,{parent:n,key:i,index:o,updateSchema:t})]):f.push(this.encodeNode(e.value,{parent:n,key:i,index:o,updateSchema:t}))),"add"!==e.op&&"oldValue"in e&&f.push(this.encodeNode(e.oldValue,{parent:n,key:i,index:o,updateSchema:t})),"remove"===e.op&&s&&t&&this.schema.deleteNode(s),h.encode(f)},a.prototype.decodePatch=function(e){var t=h.decode(e),r=t[0],i=t[1],n=t[2],s=t.slice(3),o=this.schema.getNode(i);l.check(!o,"Cannot decode patch - schema for node with id "+i+" not found");e={op:["add","replace","remove"][r],path:""},t=this.schema.getChildName(o,n),i=this.schema.getChildNode(o,t);if(s.length&&"remove"!==e.op&&(i&&this.schema.deleteNode(i),r=s.reverse().pop(),o.type===l.MAP_NODE&&"add"===e.op?(t=r[0],e.value=this.decodeNode(r[1],{parent:o,key:t,index:n})):e.value=this.decodeNode(r,{parent:o,key:t,index:n})),s.length&&"add"!==e.op&&(e.oldValue=this.decodeNode(s.pop(),{parent:o,key:t,index:n})),i&&"remove"===e.op&&this.schema.deleteNode(i),e.path=this.schema.getNodePath(o,t),s.length)throw new Error("Unhandled params: "+s.toString());return e},a);function a(e){this.schema=new f.Schema(e||{})}t.PatchPack=r},function(e,t,r){t.encode=r(5),t.decode=r(6)},function(e,t,r){"use strict";function _(e,t,r){var i=typeof r,n=0,s=0,o=0,f=0,h=0;if("string"==i){if((f=function(e){for(var t,r=0,i=0,n=e.length;i<n;i++)(t=e.charCodeAt(i))<128?r+=1:t<2048?r+=2:t<55296||57344<=t?r+=3:(i++,r+=4);return r}(r))<32)e.push(160|f),h=1;else if(f<256)e.push(217,f),h=2;else if(f<65536)e.push(218,f>>8,f),h=3;else{if(!(f<4294967296))throw new Error("String too long");e.push(219,f>>24,f>>16,f>>8,f),h=5}return t.push({_str:r,_length:f,_offset:e.length}),h+f}if("number"==i)return Math.floor(r)===r&&isFinite(r)?0<=r?r<128?(e.push(r),1):r<256?(e.push(204,r),2):r<65536?(e.push(205,r>>8,r),3):r<4294967296?(e.push(206,r>>24,r>>16,r>>8,r),5):(s=r/Math.pow(2,32)>>0,o=r>>>0,e.push(207,s>>24,s>>16,s>>8,s,o>>24,o>>16,o>>8,o),9):-32<=r?(e.push(r),1):-128<=r?(e.push(208,r),2):-32768<=r?(e.push(209,r>>8,r),3):-2147483648<=r?(e.push(210,r>>24,r>>16,r>>8,r),5):(s=Math.floor(r/Math.pow(2,32)),o=r>>>0,e.push(211,s>>24,s>>16,s>>8,s,o>>24,o>>16,o>>8,o),9):(e.push(203),t.push({_float:r,_length:8,_offset:e.length}),9);if("object"==i){if(null===r)return e.push(192),1;if(Array.isArray(r)){if((f=r.length)<16)e.push(144|f),h=1;else if(f<65536)e.push(220,f>>8,f),h=3;else{if(!(f<4294967296))throw new Error("Array too large");e.push(221,f>>24,f>>16,f>>8,f),h=5}for(n=0;n<f;n++)h+=_(e,t,r[n]);return h}if(r instanceof Date){var a=r.getTime(),s=Math.floor(a/Math.pow(2,32)),o=a>>>0;return e.push(215,0,s>>24,s>>16,s>>8,s,o>>24,o>>16,o>>8,o),10}if(r instanceof ArrayBuffer){if((f=r.byteLength)<256)e.push(196,f),h=2;else if(f<65536)e.push(197,f>>8,f),h=3;else{if(!(f<4294967296))throw new Error("Buffer too large");e.push(198,f>>24,f>>16,f>>8,f),h=5}return t.push({_bin:r,_length:f,_offset:e.length}),h+f}if("function"==typeof r.toJSON)return _(e,t,r.toJSON());for(var u=[],c="",p=Object.keys(r),n=0,d=p.length;n<d;n++)"function"!=typeof r[c=p[n]]&&u.push(c);if((f=u.length)<16)e.push(128|f),h=1;else if(f<65536)e.push(222,f>>8,f),h=3;else{if(!(f<4294967296))throw new Error("Object too large");e.push(223,f>>24,f>>16,f>>8,f),h=5}for(n=0;n<f;n++)h+=_(e,t,c=u[n]),h+=_(e,t,r[c]);return h}if("boolean"==i)return e.push(r?195:194),1;if("undefined"==i)return e.push(212,0,0),3;throw new Error("Could not encode")}e.exports=function(e){var t=[],r=[],e=_(t,r,e),e=new ArrayBuffer(e),i=new DataView(e),n=0,s=0,o=-1;0<r.length&&(o=r[0]._offset);for(var f,h,a,u=0,c=t.length;u<c;u++)if(i.setUint8(s+u,t[u]),u+1===o){if(h=(f=r[n])._length,a=s+o,f._bin)for(var p=new Uint8Array(f._bin),d=0;d<h;d++)i.setUint8(a+d,p[d]);else f._str?function(e,t,r){for(var i=0,n=0,s=r.length;n<s;n++)(i=r.charCodeAt(n))<128?e.setUint8(t++,i):(i<2048?e.setUint8(t++,192|i>>6):(i<55296||57344<=i?e.setUint8(t++,224|i>>12):(n++,i=65536+((1023&i)<<10|1023&r.charCodeAt(n)),e.setUint8(t++,240|i>>18),e.setUint8(t++,128|i>>12&63)),e.setUint8(t++,128|i>>6&63)),e.setUint8(t++,128|63&i))}(i,a,f._str):void 0!==f._float&&i.setFloat64(a,f._float);s+=h,r[++n]&&(o=r[n]._offset)}return e}},function(e,t,r){"use strict";function i(e){if(this._offset=0,e instanceof ArrayBuffer)this._buffer=e,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(e))throw new Error("Invalid argument");this._buffer=e.buffer,this._view=new DataView(this._buffer,e.byteOffset,e.byteLength)}}i.prototype._array=function(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=this._parse();return t},i.prototype._map=function(e){for(var t={},r=0;r<e;r++)t[this._parse()]=this._parse();return t},i.prototype._str=function(e){var t=function(e,t,r){for(var i="",n=0,s=t,o=t+r;s<o;s++){var f=e.getUint8(s);if(0!=(128&f))if(192!=(224&f))if(224!=(240&f)){if(240!=(248&f))throw new Error("Invalid byte "+f.toString(16));65536<=(n=(7&f)<<18|(63&e.getUint8(++s))<<12|(63&e.getUint8(++s))<<6|(63&e.getUint8(++s))<<0)?(n-=65536,i+=String.fromCharCode(55296+(n>>>10),56320+(1023&n))):i+=String.fromCharCode(n)}else i+=String.fromCharCode((15&f)<<12|(63&e.getUint8(++s))<<6|(63&e.getUint8(++s))<<0);else i+=String.fromCharCode((31&f)<<6|63&e.getUint8(++s));else i+=String.fromCharCode(f)}return i}(this._view,this._offset,e);return this._offset+=e,t},i.prototype._bin=function(e){var t=this._buffer.slice(this._offset,this._offset+e);return this._offset+=e,t},i.prototype._parse=function(){var e,t=this._view.getUint8(this._offset++),r=0,i=0,n=0,s=0;if(t<192)return t<128?t:t<144?this._map(15&t):t<160?this._array(15&t):this._str(31&t);if(223<t)return-1*(255-t+1);switch(t){case 192:return null;case 194:return!1;case 195:return!0;case 196:return r=this._view.getUint8(this._offset),this._offset+=1,this._bin(r);case 197:return r=this._view.getUint16(this._offset),this._offset+=2,this._bin(r);case 198:return r=this._view.getUint32(this._offset),this._offset+=4,this._bin(r);case 199:return r=this._view.getUint8(this._offset),i=this._view.getInt8(this._offset+1),this._offset+=2,[i,this._bin(r)];case 200:return r=this._view.getUint16(this._offset),i=this._view.getInt8(this._offset+2),this._offset+=3,[i,this._bin(r)];case 201:return r=this._view.getUint32(this._offset),i=this._view.getInt8(this._offset+4),this._offset+=5,[i,this._bin(r)];case 202:return e=this._view.getFloat32(this._offset),this._offset+=4,e;case 203:return e=this._view.getFloat64(this._offset),this._offset+=8,e;case 204:return e=this._view.getUint8(this._offset),this._offset+=1,e;case 205:return e=this._view.getUint16(this._offset),this._offset+=2,e;case 206:return e=this._view.getUint32(this._offset),this._offset+=4,e;case 207:return n=this._view.getUint32(this._offset)*Math.pow(2,32),s=this._view.getUint32(this._offset+4),this._offset+=8,n+s;case 208:return e=this._view.getInt8(this._offset),this._offset+=1,e;case 209:return e=this._view.getInt16(this._offset),this._offset+=2,e;case 210:return e=this._view.getInt32(this._offset),this._offset+=4,e;case 211:return n=this._view.getInt32(this._offset)*Math.pow(2,32),s=this._view.getUint32(this._offset+4),this._offset+=8,n+s;case 212:return i=this._view.getInt8(this._offset),this._offset+=1,0===i?void(this._offset+=1):[i,this._bin(1)];case 213:return i=this._view.getInt8(this._offset),this._offset+=1,[i,this._bin(2)];case 214:return i=this._view.getInt8(this._offset),this._offset+=1,[i,this._bin(4)];case 215:return i=this._view.getInt8(this._offset),this._offset+=1,0===i?(n=this._view.getInt32(this._offset)*Math.pow(2,32),s=this._view.getUint32(this._offset+4),this._offset+=8,new Date(n+s)):[i,this._bin(8)];case 216:return i=this._view.getInt8(this._offset),this._offset+=1,[i,this._bin(16)];case 217:return r=this._view.getUint8(this._offset),this._offset+=1,this._str(r);case 218:return r=this._view.getUint16(this._offset),this._offset+=2,this._str(r);case 219:return r=this._view.getUint32(this._offset),this._offset+=4,this._str(r);case 220:return r=this._view.getUint16(this._offset),this._offset+=2,this._array(r);case 221:return r=this._view.getUint32(this._offset),this._offset+=4,this._array(r);case 222:return r=this._view.getUint16(this._offset),this._offset+=2,this._map(r);case 223:return r=this._view.getUint32(this._offset),this._offset+=4,this._map(r)}throw new Error("Could not parse")},e.exports=function(e){var t=new i(e),r=t._parse();if(t._offset!==e.byteLength)throw new Error(e.byteLength-t._offset+" trailing bytes");return r}}],n.c=i,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2);function n(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}var r,i});