/*! patchpack@0.4.0 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.patchpack=t():e.patchpack=t()}(self||this,function(){return r={},i.m=n=[function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.OP_REMOVE=t.OP_REPLACE=t.OP_ADD=t.check=t.MAP_NODE=t.ARRAY_NODE=void 0,t.ARRAY_NODE=-1,t.MAP_NODE=-2,t.check=function(e,t){if(e)throw new Error(t)},t.OP_ADD=(r=[0,1,2])[0],t.OP_REPLACE=r[1],t.OP_REMOVE=r[2]},function(e,t,n){"use strict";var r=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),i=0,t=0;t<n;t++)for(var o=arguments[t],s=0,h=o.length;s<h;s++,i++)r[i]=o[s];return r};Object.defineProperty(t,"__esModule",{value:!0}),t.Schema=void 0;var o=n(0),n=(Object.defineProperty(i.prototype,"types",{get:function(){return this._types.map(function(e){var t=e.name,e=e.props;return r([t],e)})},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"deleted",{get:function(){return this._deleted},enumerable:!1,configurable:!0}),i.prototype.addType=function(e,t,n){var r=this._types.length;this._types.push({name:e,props:t,index:r,ref:n})},i.prototype.typeByName=function(t){return this._types.find(function(e){return e.name===t})},Object.defineProperty(i.prototype,"root",{get:function(){return this._nodes[0]},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"nextId",{get:function(){return this._nextId++},enumerable:!1,configurable:!0}),i.prototype.init=function(e){var n=this;this._types=[],this._nodes=[],e.forEach(function(e){var t=e[0],e=e.slice(1);return n._types.push({name:t,props:e,index:n._types.length})})},i.prototype.getNode=function(t){return this._nodes.find(function(e){return e.id===t})},i.prototype.getNodePath=function(e,t){for(var n=e,r=[];n;)r.push(n.key),n=n.parent;return r.reverse().join("/")+(void 0===t?"":"/"+t)},i.prototype.getChildNode=function(e,t){return e.type===o.MAP_NODE?e.items.find(function(e){return e.key===t}):e.type===o.ARRAY_NODE?e.items.find(function(e){return e.index===+t}):e.items.find(function(e){return e.key===t})},i.prototype.findType=function(i){var o=Object.keys(i);return this._types.find(function(e){if(e.ref)return i instanceof e.ref;for(var t=0,n=o;t<n.length;t++){var r=n[t];if(e.props.indexOf(r)<0)return!1}return!0})},i.prototype.getType=function(e){return e<0?e:this._types[e]},i.prototype.getChildIndex=function(e,t){return e.type===o.MAP_NODE?e.keys.indexOf(t):e.type===o.ARRAY_NODE?+t:e.type.props.indexOf(t)},i.prototype.getChildName=function(e,t){return e?e.type===o.MAP_NODE?(o.check(t>=e.keys.length,"Cannot decode value - map "+this.getNodePath(e)+" doesnt hava key with index "+t+"\n"+e.keys.toString()),e.keys[t]):e.type===o.ARRAY_NODE?t:e.type.props[t]:""},i.prototype.createNode=function(e,t,n,r,i){i={id:e,type:n,parent:t,key:r,index:i,items:[]};return n===o.MAP_NODE&&(i.keys=[]),null!=t&&t.items.push(i),this._nodes.push(i),i},i.prototype.deleteNode=function(e){var t=this;e.parent&&(n=e.parent.items.indexOf(e),e.parent.items.splice(n,1)),e.items.forEach(function(e){return t.deleteNode(e)});var n=this._nodes.indexOf(e);this._nodes.splice(n,1),this._deleted.push(e)},i.prototype.getDeletedNode=function(n,r){if(n)return n.type===o.ARRAY_NODE?this._deleted.find(function(e){var t=e.parent;return e.index===+r&&t===n}):this._deleted.find(function(e){var t=e.parent;return e.key===r&&t===n})},i.prototype.clearDeleted=function(){this._deleted=[]},i);function i(r){this._nextId=0,this._nodes=[],this._deleted=[],this._types=Object.keys(r).map(function(e,t){var n=r[e];return Array.isArray(n)?{name:e,props:n,index:t}:{name:n.name,props:Object.getOwnPropertyNames(new n),index:t,ref:n}})}t.Schema=n},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(3),t),i(n(1),t),i(n(0),t)},function(e,t,n){"use strict";var d=this&&this.__assign||function(){return(d=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},s=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),i=0,t=0;t<n;t++)for(var o=arguments[t],s=0,h=o.length;s<h;s++,i++)r[i]=o[s];return r};Object.defineProperty(t,"__esModule",{value:!0}),t.PatchPack=void 0;var f=o(n(4)),v=n(0),h=n(1),n=(a.prototype.encodeState=function(e,t,n){void 0===t&&(t=!0),void 0===n&&(n=!0);n=this.encodeNode(e,{key:"",index:-1,updateSchema:n}),t=s([n],t?[this.schema.types]:[]);return f.encode(t)},a.prototype.decodeState=function(e){var t=f.decode(e),e=t[0],t=t[1];return this.schema.init(t),this.decodeNode(e,{key:"",index:-1})},a.prototype.encodeNode=function(n,r){var i,o=this,e=r.parent,t=r.key,s=void 0===t?"":t,h=r.index,t=void 0===h?-1:h,h=r.updateSchema,f=void 0===h||h,h=r.checkDeleted;e&&e.type===v.MAP_NODE&&f&&e.keys.push(s),i=e?(h&&(i=this.schema.getDeletedNode(e,s)),i||this.schema.getChildNode(e,s)):this.schema.root;var a=[];if(Array.isArray(n)){!i&&f&&(i=this.schema.createNode(this.schema.nextId,e,v.ARRAY_NODE,s,t)),v.check(!i,"Cannot encode value - node not found on path: "+this.schema.getNodePath(e,s)),a.push(v.ARRAY_NODE,i.id);for(var u=0;u<n.length;u++)a.push(this.encodeNode(n[u],{parent:i,key:u,index:u,updateSchema:f}))}else{if("object"!=typeof n||!n)return v.check("function"==typeof n||"symbol"==typeof n,"Cannot encode value - wrong value on path "+this.schema.getNodePath(e,s)),n;var c=i?i.type:this.schema.findType(n)||v.MAP_NODE;!i&&f&&(i=this.schema.createNode(this.schema.nextId,e,c,s,t)),v.check(!i,"Cannot encode value - node not found on path: "+this.schema.getNodePath(e,s)),a.push(c!==v.MAP_NODE?c.index:v.MAP_NODE,i.id),c!==v.MAP_NODE?Object.keys(n).forEach(function(e){a.push(o.encodeNode(n[e],d(d({},r),{parent:i,key:e,index:c.props.indexOf(e)})))}):Object.keys(n).forEach(function(e,t){a.push(e,o.encodeNode(n[e],d(d({},r),{parent:i,key:e,index:t})))})}return a},a.prototype.decodeNode=function(e,t){var n=this;if(!e||!Array.isArray(e))return e;var r,i=t.parent,o=t.key,s=t.index,h=t.updateSchema,f=void 0===h||h,a=t.checkDeleted,h=void 0!==a&&a,t=e[0],a=e[1],u=e.slice(2),c=this.schema.getType(t);v.check(!c,"Cannot decode state - unknown type: "+t),f?r=this.schema.createNode(a,i,c,o,s):(h&&(r=this.schema.getDeletedNode(i,o)),!r&&i&&(r=this.schema.getChildNode(i,o))),v.check(!r,"Cannot decode value - node for "+this.schema.getNodePath(i,o)+" not found}");var d={};if(c===v.ARRAY_NODE)return u.map(function(e,t){return n.decodeNode(e,{parent:r,index:t,key:t})});if(c===v.MAP_NODE)for(var p=0;p<u.length;p+=2){var _=r.keys.push(u[p])-1;void 0!==(l=this.decodeNode(u[p+1],{parent:r,key:u[p],index:_}))&&(d[u[p]]=l)}else for(p=0;p<c.props.length;p++){var l,y=c.props[p];void 0!==(l=this.decodeNode(u[p],{parent:r,key:y,index:p}))&&(d[y]=l)}return d},a.prototype.encodePatch=function(e,t){void 0===t&&(t=!0);var n=("/"===e.path[0]?e.path.slice(1):e.path).split("/").reverse(),r=n.splice(0,1)[0];t&&this.schema.clearDeleted();var i=this.schema.root;for(v.check(!i,"Cannot encode patch, you need to build schema first!");n.length;)i=this.schema.getChildNode(i,n.pop()),v.check(!i,"Cannot add new node - wrong path: "+e.path);var o=["add","replace","remove"].indexOf(e.op),s=this.schema.getChildIndex(i,r),h=[o,i.id,s],o=this.schema.getChildNode(i,r);return"remove"!==e.op&&(o&&t&&this.schema.deleteNode(o),i.type===v.MAP_NODE&&"add"===e.op?h.push([r,this.encodeNode(e.value,{parent:i,key:r,index:s,updateSchema:t})]):h.push(this.encodeNode(e.value,{parent:i,key:r,index:s,updateSchema:t}))),"add"!==e.op&&"oldValue"in e&&h.push(this.encodeNode(e.oldValue,{parent:i,key:r,index:s,updateSchema:!1,checkDeleted:!0})),"remove"!==e.op&&o&&t&&this.schema.deleteNode(o),f.encode(h)},a.prototype.decodePatch=function(e){var t=f.decode(e),n=t[0],r=t[1],i=t[2],o=t.slice(3),s=this.schema.getNode(r);v.check(!s,"Cannot decode patch - schema for node with id "+r+" not found");var h={op:["add","replace","remove"][n],path:""},e=s.type===v.MAP_NODE&&"add"===h.op?o[0][0]:this.schema.getChildName(s,i),t=this.schema.getChildNode(s,e);if(o.length&&"remove"!==h.op&&(t&&this.schema.deleteNode(t),r=o.reverse().pop(),s.type===v.MAP_NODE&&"add"===h.op?(null!==(n=s.keys)&&void 0!==n&&n.push(e),h.value=this.decodeNode(r[1],{parent:s,key:e,index:i})):h.value=this.decodeNode(r,{parent:s,key:e,index:i})),o.length&&"add"!==h.op&&(h.oldValue=this.decodeNode(o.pop(),{parent:s,key:e,index:i,updateSchema:!1,checkDeleted:!0})),t&&"remove"===h.op&&this.schema.deleteNode(t),h.path=this.schema.getNodePath(s,e),o.length)throw new Error("Unhandled params: "+o.toString());return h},a.encode=function(e){return f.encode(e)},a.decode=function(e){return f.decode(e)},a);function a(e){this.schema=new h.Schema(e||{})}t.PatchPack=n},function(e,t,n){t.encode=n(5),t.decode=n(6)},function(e,t,n){"use strict";function _(e,t,n){var r=typeof n,i=0,o=0,s=0,h=0,f=0;if("string"==r){if((h=function(e){for(var t,n=0,r=0,i=e.length;r<i;r++)(t=e.charCodeAt(r))<128?n+=1:t<2048?n+=2:t<55296||57344<=t?n+=3:(r++,n+=4);return n}(n))<32)e.push(160|h),f=1;else if(h<256)e.push(217,h),f=2;else if(h<65536)e.push(218,h>>8,h),f=3;else{if(!(h<4294967296))throw new Error("String too long");e.push(219,h>>24,h>>16,h>>8,h),f=5}return t.push({_str:n,_length:h,_offset:e.length}),f+h}if("number"==r)return Math.floor(n)===n&&isFinite(n)?0<=n?n<128?(e.push(n),1):n<256?(e.push(204,n),2):n<65536?(e.push(205,n>>8,n),3):n<4294967296?(e.push(206,n>>24,n>>16,n>>8,n),5):(o=n/Math.pow(2,32)>>0,s=n>>>0,e.push(207,o>>24,o>>16,o>>8,o,s>>24,s>>16,s>>8,s),9):-32<=n?(e.push(n),1):-128<=n?(e.push(208,n),2):-32768<=n?(e.push(209,n>>8,n),3):-2147483648<=n?(e.push(210,n>>24,n>>16,n>>8,n),5):(o=Math.floor(n/Math.pow(2,32)),s=n>>>0,e.push(211,o>>24,o>>16,o>>8,o,s>>24,s>>16,s>>8,s),9):(e.push(203),t.push({_float:n,_length:8,_offset:e.length}),9);if("object"==r){if(null===n)return e.push(192),1;if(Array.isArray(n)){if((h=n.length)<16)e.push(144|h),f=1;else if(h<65536)e.push(220,h>>8,h),f=3;else{if(!(h<4294967296))throw new Error("Array too large");e.push(221,h>>24,h>>16,h>>8,h),f=5}for(i=0;i<h;i++)f+=_(e,t,n[i]);return f}if(n instanceof Date){var a=n.getTime(),o=Math.floor(a/Math.pow(2,32)),s=a>>>0;return e.push(215,0,o>>24,o>>16,o>>8,o,s>>24,s>>16,s>>8,s),10}if(n instanceof ArrayBuffer){if((h=n.byteLength)<256)e.push(196,h),f=2;else if(h<65536)e.push(197,h>>8,h),f=3;else{if(!(h<4294967296))throw new Error("Buffer too large");e.push(198,h>>24,h>>16,h>>8,h),f=5}return t.push({_bin:n,_length:h,_offset:e.length}),f+h}if("function"==typeof n.toJSON)return _(e,t,n.toJSON());for(var u=[],c="",d=Object.keys(n),i=0,p=d.length;i<p;i++)"function"!=typeof n[c=d[i]]&&u.push(c);if((h=u.length)<16)e.push(128|h),f=1;else if(h<65536)e.push(222,h>>8,h),f=3;else{if(!(h<4294967296))throw new Error("Object too large");e.push(223,h>>24,h>>16,h>>8,h),f=5}for(i=0;i<h;i++)f+=_(e,t,c=u[i]),f+=_(e,t,n[c]);return f}if("boolean"==r)return e.push(n?195:194),1;if("undefined"==r)return e.push(212,0,0),3;throw new Error("Could not encode")}e.exports=function(e){var t=[],n=[],e=_(t,n,e),e=new ArrayBuffer(e),r=new DataView(e),i=0,o=0,s=-1;0<n.length&&(s=n[0]._offset);for(var h,f,a,u=0,c=t.length;u<c;u++)if(r.setUint8(o+u,t[u]),u+1===s){if(f=(h=n[i])._length,a=o+s,h._bin)for(var d=new Uint8Array(h._bin),p=0;p<f;p++)r.setUint8(a+p,d[p]);else h._str?function(e,t,n){for(var r=0,i=0,o=n.length;i<o;i++)(r=n.charCodeAt(i))<128?e.setUint8(t++,r):(r<2048?e.setUint8(t++,192|r>>6):(r<55296||57344<=r?e.setUint8(t++,224|r>>12):(i++,r=65536+((1023&r)<<10|1023&n.charCodeAt(i)),e.setUint8(t++,240|r>>18),e.setUint8(t++,128|r>>12&63)),e.setUint8(t++,128|r>>6&63)),e.setUint8(t++,128|63&r))}(r,a,h._str):void 0!==h._float&&r.setFloat64(a,h._float);o+=f,n[++i]&&(s=n[i]._offset)}return e}},function(e,t,n){"use strict";function r(e){if(this._offset=0,e instanceof ArrayBuffer)this._buffer=e,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(e))throw new Error("Invalid argument");this._buffer=e.buffer,this._view=new DataView(this._buffer,e.byteOffset,e.byteLength)}}r.prototype._array=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=this._parse();return t},r.prototype._map=function(e){for(var t={},n=0;n<e;n++)t[this._parse()]=this._parse();return t},r.prototype._str=function(e){var t=function(e,t,n){for(var r="",i=0,o=t,s=t+n;o<s;o++){var h=e.getUint8(o);if(0!=(128&h))if(192!=(224&h))if(224!=(240&h)){if(240!=(248&h))throw new Error("Invalid byte "+h.toString(16));65536<=(i=(7&h)<<18|(63&e.getUint8(++o))<<12|(63&e.getUint8(++o))<<6|(63&e.getUint8(++o))<<0)?(i-=65536,r+=String.fromCharCode(55296+(i>>>10),56320+(1023&i))):r+=String.fromCharCode(i)}else r+=String.fromCharCode((15&h)<<12|(63&e.getUint8(++o))<<6|(63&e.getUint8(++o))<<0);else r+=String.fromCharCode((31&h)<<6|63&e.getUint8(++o));else r+=String.fromCharCode(h)}return r}(this._view,this._offset,e);return this._offset+=e,t},r.prototype._bin=function(e){var t=this._buffer.slice(this._offset,this._offset+e);return this._offset+=e,t},r.prototype._parse=function(){var e,t=this._view.getUint8(this._offset++),n=0,r=0,i=0,o=0;if(t<192)return t<128?t:t<144?this._map(15&t):t<160?this._array(15&t):this._str(31&t);if(223<t)return-1*(255-t+1);switch(t){case 192:return null;case 194:return!1;case 195:return!0;case 196:return n=this._view.getUint8(this._offset),this._offset+=1,this._bin(n);case 197:return n=this._view.getUint16(this._offset),this._offset+=2,this._bin(n);case 198:return n=this._view.getUint32(this._offset),this._offset+=4,this._bin(n);case 199:return n=this._view.getUint8(this._offset),r=this._view.getInt8(this._offset+1),this._offset+=2,[r,this._bin(n)];case 200:return n=this._view.getUint16(this._offset),r=this._view.getInt8(this._offset+2),this._offset+=3,[r,this._bin(n)];case 201:return n=this._view.getUint32(this._offset),r=this._view.getInt8(this._offset+4),this._offset+=5,[r,this._bin(n)];case 202:return e=this._view.getFloat32(this._offset),this._offset+=4,e;case 203:return e=this._view.getFloat64(this._offset),this._offset+=8,e;case 204:return e=this._view.getUint8(this._offset),this._offset+=1,e;case 205:return e=this._view.getUint16(this._offset),this._offset+=2,e;case 206:return e=this._view.getUint32(this._offset),this._offset+=4,e;case 207:return i=this._view.getUint32(this._offset)*Math.pow(2,32),o=this._view.getUint32(this._offset+4),this._offset+=8,i+o;case 208:return e=this._view.getInt8(this._offset),this._offset+=1,e;case 209:return e=this._view.getInt16(this._offset),this._offset+=2,e;case 210:return e=this._view.getInt32(this._offset),this._offset+=4,e;case 211:return i=this._view.getInt32(this._offset)*Math.pow(2,32),o=this._view.getUint32(this._offset+4),this._offset+=8,i+o;case 212:return r=this._view.getInt8(this._offset),this._offset+=1,0===r?void(this._offset+=1):[r,this._bin(1)];case 213:return r=this._view.getInt8(this._offset),this._offset+=1,[r,this._bin(2)];case 214:return r=this._view.getInt8(this._offset),this._offset+=1,[r,this._bin(4)];case 215:return r=this._view.getInt8(this._offset),this._offset+=1,0===r?(i=this._view.getInt32(this._offset)*Math.pow(2,32),o=this._view.getUint32(this._offset+4),this._offset+=8,new Date(i+o)):[r,this._bin(8)];case 216:return r=this._view.getInt8(this._offset),this._offset+=1,[r,this._bin(16)];case 217:return n=this._view.getUint8(this._offset),this._offset+=1,this._str(n);case 218:return n=this._view.getUint16(this._offset),this._offset+=2,this._str(n);case 219:return n=this._view.getUint32(this._offset),this._offset+=4,this._str(n);case 220:return n=this._view.getUint16(this._offset),this._offset+=2,this._array(n);case 221:return n=this._view.getUint32(this._offset),this._offset+=4,this._array(n);case 222:return n=this._view.getUint16(this._offset),this._offset+=2,this._map(n);case 223:return n=this._view.getUint32(this._offset),this._offset+=4,this._map(n)}throw new Error("Could not parse")},e.exports=function(e){var t=new r(e),n=t._parse();if(t._offset!==e.byteLength)throw new Error(e.byteLength-t._offset+" trailing bytes");return n}}],i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=2);function i(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}var n,r});