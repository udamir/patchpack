/*! patchpack@0.3.0 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.patchpack=t():e.patchpack=t()}(self||this,function(){return r={},n.m=i=[function(e,t,i){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.OP_REMOVE=t.OP_REPLACE=t.OP_ADD=t.check=t.MAP_NODE=t.ARRAY_NODE=void 0,t.ARRAY_NODE=-1,t.MAP_NODE=-2,t.check=function(e,t){if(e)throw new Error(t)},t.OP_ADD=(r=[0,1,2])[0],t.OP_REPLACE=r[1],t.OP_REMOVE=r[2]},function(e,t,i){"use strict";var r=this&&this.__spreadArrays||function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;for(var r=Array(e),n=0,t=0;t<i;t++)for(var s=arguments[t],o=0,f=s.length;o<f;o++,n++)r[n]=s[o];return r};Object.defineProperty(t,"__esModule",{value:!0}),t.Schema=void 0;var s=i(0),i=(Object.defineProperty(n.prototype,"types",{get:function(){return this._types.map(function(e){var t=e.name,e=e.props;return r([t],e)})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"root",{get:function(){return this._nodes[0]},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"nextId",{get:function(){return this._nextId++},enumerable:!1,configurable:!0}),n.prototype.init=function(e){var i=this;this._types=[],this._nodes=[],e.forEach(function(e){var t=e[0],e=e.slice(1);return i.addType(t,e)})},n.prototype.addType=function(t,e){s.check(this.types.find(function(e){return e[0]===t}),"Cannot add type to schema - type "+t+" already exists!"),this._types.push({name:t,props:e,index:this._types.length})},n.prototype.addTypes=function(t){var i=this;Object.keys(t).map(function(e){return i.addType(e,t[e])})},n.prototype.getNode=function(t){return this._nodes.find(function(e){return e.id===t})},n.prototype.getNodePath=function(e,t){for(var i=e,r=[];i;)r.push(i.key),i=i.parent;return r.reverse().join("/")+(t?"/"+t:"")},n.prototype.getChildNode=function(e,t){return e.type===s.MAP_NODE?e.items.find(function(e){return e.key===t}):e.type===s.ARRAY_NODE?e.items.find(function(e){return e.index===+t}):e.items[e.type.props.indexOf(t)]},n.prototype.findType=function(e){var n=Object.keys(e);return this._types.find(function(e){for(var t=0,i=n;t<i.length;t++){var r=i[t];if(e.props.indexOf(r)<0)return!1}return!0})},n.prototype.getType=function(e){return e<0?e:this._types[e]},n.prototype.getChildIndex=function(e,t){return e.type===s.MAP_NODE?e.keys.indexOf(t):e.type===s.ARRAY_NODE?+t:e.type.props.indexOf(t)},n.prototype.getChildName=function(e,t){return e?e.type===s.MAP_NODE?e.keys[t]:e.type===s.ARRAY_NODE?t:e.type.props[t]:""},n.prototype.createNode=function(e,t,i,r,n){n={id:e,type:i,parent:t,key:r,index:n,items:[]};return i===s.MAP_NODE&&(n.keys=[]),null!=t&&t.items.push(n),this._nodes.push(n),n},n.prototype.deleteNode=function(e){var t=this;e.items.forEach(function(e){return t.deleteNode(e)});e=this._nodes.indexOf(e);this._nodes.splice(e,1)},n);function n(){this._nextId=0,this._nodes=[],this._types=[]}t.Schema=i},function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(3),t),n(i(1),t),n(i(0),t)},function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.hasOwnProperty.call(e,i)&&r(t,e,i);return n(t,e),t},o=this&&this.__spreadArrays||function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;for(var r=Array(e),n=0,t=0;t<i;t++)for(var s=arguments[t],o=0,f=s.length;o<f;o++,n++)r[n]=s[o];return r};Object.defineProperty(t,"__esModule",{value:!0}),t.PatchPack=void 0;var f=s(i(4)),l=i(0),h=i(1),i=(a.prototype.encodeState=function(e,t){void 0===t&&(t=!0);e=this.encodeNode(e,{key:"",index:-1}),t=o([e],t?[this.schema.types]:[]);return f.encode(t)},a.prototype.decodeState=function(e){var t=f.decode(e),e=t[0],t=t[1];return this.schema.init(t),this.decodeNode(e,{key:"",index:-1})},a.prototype.encodeNode=function(i,e){var r=this,t=e.parent,n=e.key,n=void 0===n?"":n,e=e.index,e=void 0===e?-1:e;t&&t.type===l.MAP_NODE&&t.keys.push(n);var s=t?this.schema.getChildNode(t,n):this.schema.root,o=[];if(Array.isArray(i)){s=s||this.schema.createNode(this.schema.nextId,t,l.ARRAY_NODE,n,e),o.push(l.ARRAY_NODE,s.id);for(var f=0;f<i.length;f++)o.push(this.encodeNode(i[f],{parent:s,key:f,index:f}))}else{if("object"!=typeof i||!i)return l.check("function"==typeof i||"symbol"==typeof i,"Cannot build schema - wrong value on path "+this.schema.getNodePath(t,n)),i;var h=this.schema.findType(i)||l.MAP_NODE,s=s||this.schema.createNode(this.schema.nextId,t,h,n,e);o.push(h!==l.MAP_NODE?h.index:l.MAP_NODE,s.id),h!==l.MAP_NODE?Object.keys(i).forEach(function(e){o.push(r.encodeNode(i[e],{parent:s,key:e,index:h.props.indexOf(e)}))}):Object.keys(i).forEach(function(e,t){o.push(e,r.encodeNode(i[e],{parent:s,key:e,index:t}))})}return o},a.prototype.decodeNode=function(e,t){var i=this;if(!e||!Array.isArray(e))return e;var r=t.parent,n=t.key,s=t.index,o=e[0],t=e[1],f=e.slice(2),h=this.schema.getType(o);l.check(!h,"Cannot decode state - unknown type: "+o);var a=this.schema.createNode(t,r,h,n,s),u={};if(h===l.ARRAY_NODE)return f.map(function(e,t){return i.decodeNode(e,{parent:a,index:t,key:t})});if(h===l.MAP_NODE)for(var c=0;c<f.length;c+=2){var p=a.keys.push(f[c])-1;void 0!==(d=this.decodeNode(f[c+1],{parent:a,key:f[c],index:p}))&&(u[f[c]]=d)}else for(c=0;c<h.props.length;c++){var d,_=h.props[c];void 0!==(d=this.decodeNode(f[c],{parent:a,key:_,index:c}))&&(u[_]=d)}return u},a.prototype.encodePatch=function(e){var t=("/"===e.path[0]?e.path.slice(1):e.path).split("/").reverse(),i=t.splice(0,1)[0],r=this.schema.root;for(l.check(!r,"Cannot encode patch, you need to build schema first!");t.length;)r=this.schema.getChildNode(r,t.pop()),l.check(!r,"Cannot add new node - wrong path: "+e.path);var n=["add","replace","remove"].indexOf(e.op),s=this.schema.getChildIndex(r,i),o=[n,r.id,s],n=this.schema.getChildNode(r,i);return"remove"!==e.op&&(n&&this.schema.deleteNode(n),r.type===l.MAP_NODE&&"add"===e.op?o.push([i,this.encodeNode(e.value,{parent:r,key:i,index:s})]):o.push(this.encodeNode(e.value,{parent:r,key:i,index:s}))),"add"!==e.op&&"oldValue"in e&&o.push(this.encodeNode(e.oldValue,{parent:r,key:i,index:s})),"remove"===e.op&&n&&this.schema.deleteNode(n),f.encode(o)},a.prototype.decodePatch=function(e){var t=f.decode(e),i=t[0],r=t[1],n=t[2],s=t.slice(3),o=this.schema.getNode(r);l.check(!o,"Cannot decode patch - schema for node with id "+r+" not found");e={op:["add","replace","remove"][i],path:""},t=this.schema.getChildName(o,n),r=this.schema.getChildNode(o,t);if(s.length&&"remove"!==e.op&&(r&&this.schema.deleteNode(r),i=s.reverse().pop(),o.type===l.MAP_NODE&&"add"===e.op?(t=i[0],e.value=this.decodeNode(i[1],{parent:o,key:t,index:n})):e.value=this.decodeNode(i,{parent:o,key:t,index:n})),s.length&&"add"!==e.op&&(e.oldValue=this.decodeNode(s.pop(),{parent:o,key:t,index:n})),r&&"remove"===e.op&&this.schema.deleteNode(r),e.path=this.schema.getNodePath(o,t),s.length)throw new Error("Unhandled params: "+s.toString());return e},a);function a(e){this.schema=new h.Schema,this.schema.addTypes(e||{})}t.PatchPack=i},function(e,t,i){t.encode=i(5),t.decode=i(6)},function(e,t,i){"use strict";function _(e,t,i){var r=typeof i,n=0,s=0,o=0,f=0,h=0;if("string"==r){if((f=function(e){for(var t,i=0,r=0,n=e.length;r<n;r++)(t=e.charCodeAt(r))<128?i+=1:t<2048?i+=2:t<55296||57344<=t?i+=3:(r++,i+=4);return i}(i))<32)e.push(160|f),h=1;else if(f<256)e.push(217,f),h=2;else if(f<65536)e.push(218,f>>8,f),h=3;else{if(!(f<4294967296))throw new Error("String too long");e.push(219,f>>24,f>>16,f>>8,f),h=5}return t.push({_str:i,_length:f,_offset:e.length}),h+f}if("number"==r)return Math.floor(i)===i&&isFinite(i)?0<=i?i<128?(e.push(i),1):i<256?(e.push(204,i),2):i<65536?(e.push(205,i>>8,i),3):i<4294967296?(e.push(206,i>>24,i>>16,i>>8,i),5):(s=i/Math.pow(2,32)>>0,o=i>>>0,e.push(207,s>>24,s>>16,s>>8,s,o>>24,o>>16,o>>8,o),9):-32<=i?(e.push(i),1):-128<=i?(e.push(208,i),2):-32768<=i?(e.push(209,i>>8,i),3):-2147483648<=i?(e.push(210,i>>24,i>>16,i>>8,i),5):(s=Math.floor(i/Math.pow(2,32)),o=i>>>0,e.push(211,s>>24,s>>16,s>>8,s,o>>24,o>>16,o>>8,o),9):(e.push(203),t.push({_float:i,_length:8,_offset:e.length}),9);if("object"==r){if(null===i)return e.push(192),1;if(Array.isArray(i)){if((f=i.length)<16)e.push(144|f),h=1;else if(f<65536)e.push(220,f>>8,f),h=3;else{if(!(f<4294967296))throw new Error("Array too large");e.push(221,f>>24,f>>16,f>>8,f),h=5}for(n=0;n<f;n++)h+=_(e,t,i[n]);return h}if(i instanceof Date){var a=i.getTime(),s=Math.floor(a/Math.pow(2,32)),o=a>>>0;return e.push(215,0,s>>24,s>>16,s>>8,s,o>>24,o>>16,o>>8,o),10}if(i instanceof ArrayBuffer){if((f=i.byteLength)<256)e.push(196,f),h=2;else if(f<65536)e.push(197,f>>8,f),h=3;else{if(!(f<4294967296))throw new Error("Buffer too large");e.push(198,f>>24,f>>16,f>>8,f),h=5}return t.push({_bin:i,_length:f,_offset:e.length}),h+f}if("function"==typeof i.toJSON)return _(e,t,i.toJSON());for(var u=[],c="",p=Object.keys(i),n=0,d=p.length;n<d;n++)"function"!=typeof i[c=p[n]]&&u.push(c);if((f=u.length)<16)e.push(128|f),h=1;else if(f<65536)e.push(222,f>>8,f),h=3;else{if(!(f<4294967296))throw new Error("Object too large");e.push(223,f>>24,f>>16,f>>8,f),h=5}for(n=0;n<f;n++)h+=_(e,t,c=u[n]),h+=_(e,t,i[c]);return h}if("boolean"==r)return e.push(i?195:194),1;if("undefined"==r)return e.push(212,0,0),3;throw new Error("Could not encode")}e.exports=function(e){var t=[],i=[],e=_(t,i,e),e=new ArrayBuffer(e),r=new DataView(e),n=0,s=0,o=-1;0<i.length&&(o=i[0]._offset);for(var f,h,a,u=0,c=t.length;u<c;u++)if(r.setUint8(s+u,t[u]),u+1===o){if(h=(f=i[n])._length,a=s+o,f._bin)for(var p=new Uint8Array(f._bin),d=0;d<h;d++)r.setUint8(a+d,p[d]);else f._str?function(e,t,i){for(var r=0,n=0,s=i.length;n<s;n++)(r=i.charCodeAt(n))<128?e.setUint8(t++,r):(r<2048?e.setUint8(t++,192|r>>6):(r<55296||57344<=r?e.setUint8(t++,224|r>>12):(n++,r=65536+((1023&r)<<10|1023&i.charCodeAt(n)),e.setUint8(t++,240|r>>18),e.setUint8(t++,128|r>>12&63)),e.setUint8(t++,128|r>>6&63)),e.setUint8(t++,128|63&r))}(r,a,f._str):void 0!==f._float&&r.setFloat64(a,f._float);s+=h,i[++n]&&(o=i[n]._offset)}return e}},function(e,t,i){"use strict";function r(e){if(this._offset=0,e instanceof ArrayBuffer)this._buffer=e,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(e))throw new Error("Invalid argument");this._buffer=e.buffer,this._view=new DataView(this._buffer,e.byteOffset,e.byteLength)}}r.prototype._array=function(e){for(var t=new Array(e),i=0;i<e;i++)t[i]=this._parse();return t},r.prototype._map=function(e){for(var t={},i=0;i<e;i++)t[this._parse()]=this._parse();return t},r.prototype._str=function(e){var t=function(e,t,i){for(var r="",n=0,s=t,o=t+i;s<o;s++){var f=e.getUint8(s);if(0!=(128&f))if(192!=(224&f))if(224!=(240&f)){if(240!=(248&f))throw new Error("Invalid byte "+f.toString(16));65536<=(n=(7&f)<<18|(63&e.getUint8(++s))<<12|(63&e.getUint8(++s))<<6|(63&e.getUint8(++s))<<0)?(n-=65536,r+=String.fromCharCode(55296+(n>>>10),56320+(1023&n))):r+=String.fromCharCode(n)}else r+=String.fromCharCode((15&f)<<12|(63&e.getUint8(++s))<<6|(63&e.getUint8(++s))<<0);else r+=String.fromCharCode((31&f)<<6|63&e.getUint8(++s));else r+=String.fromCharCode(f)}return r}(this._view,this._offset,e);return this._offset+=e,t},r.prototype._bin=function(e){var t=this._buffer.slice(this._offset,this._offset+e);return this._offset+=e,t},r.prototype._parse=function(){var e,t=this._view.getUint8(this._offset++),i=0,r=0,n=0,s=0;if(t<192)return t<128?t:t<144?this._map(15&t):t<160?this._array(15&t):this._str(31&t);if(223<t)return-1*(255-t+1);switch(t){case 192:return null;case 194:return!1;case 195:return!0;case 196:return i=this._view.getUint8(this._offset),this._offset+=1,this._bin(i);case 197:return i=this._view.getUint16(this._offset),this._offset+=2,this._bin(i);case 198:return i=this._view.getUint32(this._offset),this._offset+=4,this._bin(i);case 199:return i=this._view.getUint8(this._offset),r=this._view.getInt8(this._offset+1),this._offset+=2,[r,this._bin(i)];case 200:return i=this._view.getUint16(this._offset),r=this._view.getInt8(this._offset+2),this._offset+=3,[r,this._bin(i)];case 201:return i=this._view.getUint32(this._offset),r=this._view.getInt8(this._offset+4),this._offset+=5,[r,this._bin(i)];case 202:return e=this._view.getFloat32(this._offset),this._offset+=4,e;case 203:return e=this._view.getFloat64(this._offset),this._offset+=8,e;case 204:return e=this._view.getUint8(this._offset),this._offset+=1,e;case 205:return e=this._view.getUint16(this._offset),this._offset+=2,e;case 206:return e=this._view.getUint32(this._offset),this._offset+=4,e;case 207:return n=this._view.getUint32(this._offset)*Math.pow(2,32),s=this._view.getUint32(this._offset+4),this._offset+=8,n+s;case 208:return e=this._view.getInt8(this._offset),this._offset+=1,e;case 209:return e=this._view.getInt16(this._offset),this._offset+=2,e;case 210:return e=this._view.getInt32(this._offset),this._offset+=4,e;case 211:return n=this._view.getInt32(this._offset)*Math.pow(2,32),s=this._view.getUint32(this._offset+4),this._offset+=8,n+s;case 212:return r=this._view.getInt8(this._offset),this._offset+=1,0===r?void(this._offset+=1):[r,this._bin(1)];case 213:return r=this._view.getInt8(this._offset),this._offset+=1,[r,this._bin(2)];case 214:return r=this._view.getInt8(this._offset),this._offset+=1,[r,this._bin(4)];case 215:return r=this._view.getInt8(this._offset),this._offset+=1,0===r?(n=this._view.getInt32(this._offset)*Math.pow(2,32),s=this._view.getUint32(this._offset+4),this._offset+=8,new Date(n+s)):[r,this._bin(8)];case 216:return r=this._view.getInt8(this._offset),this._offset+=1,[r,this._bin(16)];case 217:return i=this._view.getUint8(this._offset),this._offset+=1,this._str(i);case 218:return i=this._view.getUint16(this._offset),this._offset+=2,this._str(i);case 219:return i=this._view.getUint32(this._offset),this._offset+=4,this._str(i);case 220:return i=this._view.getUint16(this._offset),this._offset+=2,this._array(i);case 221:return i=this._view.getUint32(this._offset),this._offset+=4,this._array(i);case 222:return i=this._view.getUint16(this._offset),this._offset+=2,this._map(i);case 223:return i=this._view.getUint32(this._offset),this._offset+=4,this._map(i)}throw new Error("Could not parse")},e.exports=function(e){var t=new r(e),i=t._parse();if(t._offset!==e.byteLength)throw new Error(e.byteLength-t._offset+" trailing bytes");return i}}],n.c=r,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2);function n(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}var i,r});