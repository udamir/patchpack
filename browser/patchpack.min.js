/*! patchpack@0.1.0 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.patchpack=t():e.patchpack=t()}(self||this,function(){return i={},o.m=n=[function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.check=t.schemaPatch=t.schemaNode=t.schemaType=t.NODE_MAP_TYPE=t.NODE_ARRAY_TYPE=void 0,t.NODE_ARRAY_TYPE=-1,t.NODE_MAP_TYPE=-2,t.schemaType=function(e){return void 0===e&&(e=[]),{name:e[0],props:e.slice(1)}},t.schemaNode=function(e){return void 0===e&&(e=[]),{id:e[0],type:e[1],parent:e[2],index:e[3],items:e.slice(4)}},t.schemaPatch=function(e){return void 0===e&&(e=[]),{op:e[0],id:e[1],prop:e[2],values:e.slice(3)}},t.check=function(e,t){if(e)throw new Error(t)}},function(e,t,n){"use strict";var s=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var i=Array(e),o=0,t=0;t<n;t++)for(var r=arguments[t],s=0,h=r.length;s<h;s++,o++)i[o]=r[s];return i};Object.defineProperty(t,"__esModule",{value:!0}),t.Schema=void 0;var h=n(0),n=(i.prototype.add=function(e,t,n){void 0===n&&(n=this[e].length);var i,o,r={op:"add",path:"/"+e+"/"+n,value:s(t)};return"nodes"===e&&"string"==typeof t[3]&&(i=this.nodes.findIndex(function(e){return e[0]===t[2]}),(o=this.nodes[i].findIndex(function(e){return e===t[3]}))<4?(this.addMapNodeKey(i,t[3]),t[3]=this.nodes[i].length-5):t[3]=o-4),this[e].splice(n,0,t),r},i.prototype.replace=function(e,t,n){return{op:"replace",path:"/"+e+"/"+t,value:this[e][t]=n}},i.prototype.remove=function(e,t){return this[e].splice(t,1),{op:"remove",path:"/nodes/"+t}},i.prototype.addType=function(t,e){return h.check(this.types.find(function(e){return e[0]===t}),"Cannot add type to schema - type "+t+" already exists!"),this.add("types",s([t],e))},i.prototype.addArrayNode=function(e,t,n){return this.addNode(e,h.NODE_ARRAY_TYPE,t,n)},i.prototype.addMapNode=function(e,t,n,i){return void 0===i&&(i=[]),this.addNode(e,h.NODE_MAP_TYPE,t,n,i)},i.prototype.addObjectNode=function(e,t,n,i){var o=this.types.findIndex(function(e){return e[0]===t});return h.check(o<0,"Cannot add node to schema - node type "+t+" is not found!"),this.addNode(e,o,n,i)},i.prototype.addNode=function(e,t,n,i,o){void 0===o&&(o=[]),h.check(this.getNode(e),"Cannot add node to schema - node with id "+e+" already exists!"),h.check(-1===n&&this.nodes.length,"Cannot add second root node to schema - only root node can have parentId -1!");var r=this.getNode(n);h.check(!r&&0<=n,"Cannot add node to schema - parent with id "+n+" not found!");r="string"!=typeof i||r&&r.type===h.NODE_MAP_TYPE?i:this.getNodeIndex(n,i);return h.check(-1===r&&this.nodes.length,'Cannot add node to schema - key/index "'+i+'" not exist!'),this.add("nodes",s([e,t,n,r],o))},i.prototype.addMapNodeKey=function(e,t){var n=this.nodes[e];return h.check(!n,"Cannot add key to schema - node with index "+e+" not found"),h.check(0<=n.slice(4).indexOf(t),"Cannot add key to schema - key "+t+" already exists!"),n.push(t),{op:"add",path:"/nodes/"+e+"/"+(n.length-1),value:t}},i.prototype.deleteNode=function(t,e){var n=this;void 0===e&&(e=!1);var i=this.nodes.findIndex(function(e){return e[0]===t});return h.check(i<0,"Cannot delete node to schema - node with id "+t+" not exists!"),e&&this.nodes.filter(function(e){return e[2]===t}).forEach(function(e){return n.deleteNode(e[0])}),this.remove("nodes",i)},i.prototype.getTypeProps=function(e){e=this.types[e];return e?e.slice(1):[]},i.prototype.getNodeName=function(e){var t=Array.isArray(e)?h.schemaNode(e):e,e=this.getNode(t.parent);return e?e.type===h.NODE_ARRAY_TYPE?t.index:(e.type===h.NODE_MAP_TYPE?e.items:h.schemaType(this.types[e.type]).props)[t.index]:""},i.prototype.getNodeIndex=function(e,t){e=this.getNode(e);return e?e.type===h.NODE_MAP_TYPE?e.items.indexOf(t):e.type===h.NODE_ARRAY_TYPE?+t:this.getTypeProps(e.type).indexOf(t):-1},i.prototype.getNode=function(t){var e=this.nodes.find(function(e){return e[0]===t});return e&&h.schemaNode(e)},i.prototype.getNodePath=function(e){for(var t=Array.isArray(e)?h.schemaNode(e):e,n=[];t;)n.push(this.getNodeName(t)),t=this.getNode(t.parent);return n.reverse().join("/")},i.prototype.getChildNode=function(e,t){if(!e)return this.findNode({parent:-1});var n=Array.isArray(e)?h.schemaNode(e):e;if(n.type===h.NODE_ARRAY_TYPE)return this.findNode({parent:n.id,index:+t});if(n.type===h.NODE_MAP_TYPE)return this.findNode({parent:n.id,index:n.items.indexOf(t)});e=h.schemaType(this.types[n.type]).props;return this.findNode({parent:n.id,index:e.indexOf(t)})},i.prototype.findNode=function(n){var e=this.nodes.find(function(e){var t=h.schemaNode(e);return!Object.keys(n).find(function(e){return t[e]!==n[e]})});return e&&h.schemaNode(e)},i);function i(e){this.types=e&&e.types||[],this.nodes=e&&e.nodes||[]}t.Schema=n},function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n(3),t),o(n(1),t),o(n(0),t)},function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.hasOwnProperty.call(e,n)&&i(t,e,n);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.PatchPack=void 0;var d=r(n(4)),h=n(0),s=n(1),n=(f.prototype.encodeSchemaPatch=function(e){var t=e.path.split("/"),n=t[1],i=t[2],t=t[3],n=["add","replace","remove"].indexOf(e.op)-("nodes"===n?3:6);return d.encode([n,+i,void 0===t?-1:+t,e.value])},f.prototype.encodeNode=function(n,e,t){var i=this,o=void 0===t?e:this.schema.getChildNode(e,t);return o&&n?-2===o.type?o.items.map(function(e,t){return i.encodeNode(n[e],o,e)}):-1===o.type?n.map(function(e,t){return i.encodeNode(e,o,t)}):this.schema.getTypeProps(o.type).map(function(e,t){return i.encodeNode(n[e],o,e)}):n},f.prototype.encodeSnapshot=function(e,t){var n=this.schema.getNode(t);if(!n)throw new Error("Cannot encode Snapshot - node with id "+t+" not found!");return d.encode(this.encodeNode(e,n))},f.prototype.encodePatch=function(e){for(var t,n="/"===e.path?[""]:e.path.split("/"),i=-1;++i<n.length;){var o=this.schema.getChildNode(t,n[i]||"");if(!o)break;t=o}if(!t)throw new Error("Wrong patch path: "+e.path);var r=["add","replace","remove"].indexOf(e.op),s=this.schema.getTypeProps(t.type).indexOf(n[i]),s=[r,t.id,s];return"remove"!==e.op&&s.push(this.encodeNode(e.value,t,n[i])),"add"!==e.op&&"oldValue"in e&&s.push(this.encodeNode(e.oldValue,t,n[i])),d.encode(s)},f.prototype.decodeSchemaPatch=function(e,t){void 0===t&&(t="");var n=h.schemaPatch(e),i=["add","replace","remove"][n.op+(n.op<-3?6:3)],e=[,n.op<-3?"types":"nodes",n.id];0<=n.prop&&e.push(n.prop);e={op:i,path:t+e.join("/")};return void 0!==n.values[0]&&(e.value=n.values[0]),e},f.prototype.decodeNode=function(e,i){var o=this,r=this.schema.getNode(e);if(!r||!i)return i;if(r.type===h.NODE_ARRAY_TYPE)return i.map(function(e,t){t=o.schema.getChildNode(r,t);return o.decodeNode(t?t.id:-1,e)});var s={};return(r.type===h.NODE_MAP_TYPE?r.items:this.schema.getTypeProps(r.type)).forEach(function(e,t){var n=o.schema.getChildNode(r,e),t=o.decodeNode(n?n.id:-1,i[t]);void 0!==t&&(s[e]=t)}),s},f.prototype.decodeSnapshot=function(e,t){return this.decodeNode(t,d.decode(e))},f.prototype.decodePatch=function(e,t){void 0===t&&(t=!0);var n=d.decode(e);if(n[0]<0){var i=this.decodeSchemaPatch(n,"");if(t){var o=i.path.split("/"),r=o[1],s=+o[2];switch(i.op){case"add":return 4===o.length?this.schema.addMapNodeKey(+o[2],n[3]):this.schema.add(r,n[3],s);case"remove":return this.schema.remove(r,s);case"replace":return this.schema.replace(r,s,n[3])}}return i}var h=n[0],f=n[1],a=n[2],e=n.slice(3),t=this.schema.getNode(f);if(!t)throw new Error("Cannot decode patch - schema for node with id "+f+" not found");i=this.schema.getNodePath(t),t=this.schema.getTypeProps(t.type),i={op:["add","replace","remove"][h],path:i+(0<=a?"/"+t[a]:"")},t=this.schema.findNode({parent:f,index:a}),f=t?t.id:a<0&&f||-1;if(e.length&&"remove"!==i.op&&(i.value=this.decodeNode(f,e.reverse().pop())),e.length&&"add"!==i.op&&(i.oldValue=this.decodeNode(f,e.pop())),e.length)throw new Error("Unhandled params: "+e.toString());return i},f);function f(e){this.schema=new s.Schema(e)}t.PatchPack=n},function(e,t,n){t.encode=n(5),t.decode=n(6)},function(e,t,n){"use strict";function _(e,t,n){var i=typeof n,o=0,r=0,s=0,h=0,f=0;if("string"==i){if((h=function(e){for(var t,n=0,i=0,o=e.length;i<o;i++)(t=e.charCodeAt(i))<128?n+=1:t<2048?n+=2:t<55296||57344<=t?n+=3:(i++,n+=4);return n}(n))<32)e.push(160|h),f=1;else if(h<256)e.push(217,h),f=2;else if(h<65536)e.push(218,h>>8,h),f=3;else{if(!(h<4294967296))throw new Error("String too long");e.push(219,h>>24,h>>16,h>>8,h),f=5}return t.push({_str:n,_length:h,_offset:e.length}),f+h}if("number"==i)return Math.floor(n)===n&&isFinite(n)?0<=n?n<128?(e.push(n),1):n<256?(e.push(204,n),2):n<65536?(e.push(205,n>>8,n),3):n<4294967296?(e.push(206,n>>24,n>>16,n>>8,n),5):(r=n/Math.pow(2,32)>>0,s=n>>>0,e.push(207,r>>24,r>>16,r>>8,r,s>>24,s>>16,s>>8,s),9):-32<=n?(e.push(n),1):-128<=n?(e.push(208,n),2):-32768<=n?(e.push(209,n>>8,n),3):-2147483648<=n?(e.push(210,n>>24,n>>16,n>>8,n),5):(r=Math.floor(n/Math.pow(2,32)),s=n>>>0,e.push(211,r>>24,r>>16,r>>8,r,s>>24,s>>16,s>>8,s),9):(e.push(203),t.push({_float:n,_length:8,_offset:e.length}),9);if("object"==i){if(null===n)return e.push(192),1;if(Array.isArray(n)){if((h=n.length)<16)e.push(144|h),f=1;else if(h<65536)e.push(220,h>>8,h),f=3;else{if(!(h<4294967296))throw new Error("Array too large");e.push(221,h>>24,h>>16,h>>8,h),f=5}for(o=0;o<h;o++)f+=_(e,t,n[o]);return f}if(n instanceof Date){var a=n.getTime(),r=Math.floor(a/Math.pow(2,32)),s=a>>>0;return e.push(215,0,r>>24,r>>16,r>>8,r,s>>24,s>>16,s>>8,s),10}if(n instanceof ArrayBuffer){if((h=n.byteLength)<256)e.push(196,h),f=2;else if(h<65536)e.push(197,h>>8,h),f=3;else{if(!(h<4294967296))throw new Error("Buffer too large");e.push(198,h>>24,h>>16,h>>8,h),f=5}return t.push({_bin:n,_length:h,_offset:e.length}),f+h}if("function"==typeof n.toJSON)return _(e,t,n.toJSON());for(var d=[],u="",c=Object.keys(n),o=0,p=c.length;o<p;o++)"function"!=typeof n[u=c[o]]&&d.push(u);if((h=d.length)<16)e.push(128|h),f=1;else if(h<65536)e.push(222,h>>8,h),f=3;else{if(!(h<4294967296))throw new Error("Object too large");e.push(223,h>>24,h>>16,h>>8,h),f=5}for(o=0;o<h;o++)f+=_(e,t,u=d[o]),f+=_(e,t,n[u]);return f}if("boolean"==i)return e.push(n?195:194),1;if("undefined"==i)return e.push(212,0,0),3;throw new Error("Could not encode")}e.exports=function(e){var t=[],n=[],e=_(t,n,e),e=new ArrayBuffer(e),i=new DataView(e),o=0,r=0,s=-1;0<n.length&&(s=n[0]._offset);for(var h,f,a,d=0,u=t.length;d<u;d++)if(i.setUint8(r+d,t[d]),d+1===s){if(f=(h=n[o])._length,a=r+s,h._bin)for(var c=new Uint8Array(h._bin),p=0;p<f;p++)i.setUint8(a+p,c[p]);else h._str?function(e,t,n){for(var i=0,o=0,r=n.length;o<r;o++)(i=n.charCodeAt(o))<128?e.setUint8(t++,i):(i<2048?e.setUint8(t++,192|i>>6):(i<55296||57344<=i?e.setUint8(t++,224|i>>12):(o++,i=65536+((1023&i)<<10|1023&n.charCodeAt(o)),e.setUint8(t++,240|i>>18),e.setUint8(t++,128|i>>12&63)),e.setUint8(t++,128|i>>6&63)),e.setUint8(t++,128|63&i))}(i,a,h._str):void 0!==h._float&&i.setFloat64(a,h._float);r+=f,n[++o]&&(s=n[o]._offset)}return e}},function(e,t,n){"use strict";function i(e){if(this._offset=0,e instanceof ArrayBuffer)this._buffer=e,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(e))throw new Error("Invalid argument");this._buffer=e.buffer,this._view=new DataView(this._buffer,e.byteOffset,e.byteLength)}}i.prototype._array=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=this._parse();return t},i.prototype._map=function(e){for(var t={},n=0;n<e;n++)t[this._parse()]=this._parse();return t},i.prototype._str=function(e){var t=function(e,t,n){for(var i="",o=0,r=t,s=t+n;r<s;r++){var h=e.getUint8(r);if(0!=(128&h))if(192!=(224&h))if(224!=(240&h)){if(240!=(248&h))throw new Error("Invalid byte "+h.toString(16));65536<=(o=(7&h)<<18|(63&e.getUint8(++r))<<12|(63&e.getUint8(++r))<<6|(63&e.getUint8(++r))<<0)?(o-=65536,i+=String.fromCharCode(55296+(o>>>10),56320+(1023&o))):i+=String.fromCharCode(o)}else i+=String.fromCharCode((15&h)<<12|(63&e.getUint8(++r))<<6|(63&e.getUint8(++r))<<0);else i+=String.fromCharCode((31&h)<<6|63&e.getUint8(++r));else i+=String.fromCharCode(h)}return i}(this._view,this._offset,e);return this._offset+=e,t},i.prototype._bin=function(e){var t=this._buffer.slice(this._offset,this._offset+e);return this._offset+=e,t},i.prototype._parse=function(){var e,t=this._view.getUint8(this._offset++),n=0,i=0,o=0,r=0;if(t<192)return t<128?t:t<144?this._map(15&t):t<160?this._array(15&t):this._str(31&t);if(223<t)return-1*(255-t+1);switch(t){case 192:return null;case 194:return!1;case 195:return!0;case 196:return n=this._view.getUint8(this._offset),this._offset+=1,this._bin(n);case 197:return n=this._view.getUint16(this._offset),this._offset+=2,this._bin(n);case 198:return n=this._view.getUint32(this._offset),this._offset+=4,this._bin(n);case 199:return n=this._view.getUint8(this._offset),i=this._view.getInt8(this._offset+1),this._offset+=2,[i,this._bin(n)];case 200:return n=this._view.getUint16(this._offset),i=this._view.getInt8(this._offset+2),this._offset+=3,[i,this._bin(n)];case 201:return n=this._view.getUint32(this._offset),i=this._view.getInt8(this._offset+4),this._offset+=5,[i,this._bin(n)];case 202:return e=this._view.getFloat32(this._offset),this._offset+=4,e;case 203:return e=this._view.getFloat64(this._offset),this._offset+=8,e;case 204:return e=this._view.getUint8(this._offset),this._offset+=1,e;case 205:return e=this._view.getUint16(this._offset),this._offset+=2,e;case 206:return e=this._view.getUint32(this._offset),this._offset+=4,e;case 207:return o=this._view.getUint32(this._offset)*Math.pow(2,32),r=this._view.getUint32(this._offset+4),this._offset+=8,o+r;case 208:return e=this._view.getInt8(this._offset),this._offset+=1,e;case 209:return e=this._view.getInt16(this._offset),this._offset+=2,e;case 210:return e=this._view.getInt32(this._offset),this._offset+=4,e;case 211:return o=this._view.getInt32(this._offset)*Math.pow(2,32),r=this._view.getUint32(this._offset+4),this._offset+=8,o+r;case 212:return i=this._view.getInt8(this._offset),this._offset+=1,0===i?void(this._offset+=1):[i,this._bin(1)];case 213:return i=this._view.getInt8(this._offset),this._offset+=1,[i,this._bin(2)];case 214:return i=this._view.getInt8(this._offset),this._offset+=1,[i,this._bin(4)];case 215:return i=this._view.getInt8(this._offset),this._offset+=1,0===i?(o=this._view.getInt32(this._offset)*Math.pow(2,32),r=this._view.getUint32(this._offset+4),this._offset+=8,new Date(o+r)):[i,this._bin(8)];case 216:return i=this._view.getInt8(this._offset),this._offset+=1,[i,this._bin(16)];case 217:return n=this._view.getUint8(this._offset),this._offset+=1,this._str(n);case 218:return n=this._view.getUint16(this._offset),this._offset+=2,this._str(n);case 219:return n=this._view.getUint32(this._offset),this._offset+=4,this._str(n);case 220:return n=this._view.getUint16(this._offset),this._offset+=2,this._array(n);case 221:return n=this._view.getUint32(this._offset),this._offset+=4,this._array(n);case 222:return n=this._view.getUint16(this._offset),this._offset+=2,this._map(n);case 223:return n=this._view.getUint32(this._offset),this._offset+=4,this._map(n)}throw new Error("Could not parse")},e.exports=function(e){var t=new i(e),n=t._parse();if(t._offset!==e.byteLength)throw new Error(e.byteLength-t._offset+" trailing bytes");return n}}],o.c=i,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=2);function o(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}var n,i});